---
permalink: /search-index.json
eleventyExcludeFromCollections: true
---
{
  "documents": [
  {%- for page in collections.docs -%}
    {%- set content = page.templateContent | striptags -%}
    {%- if loop.index > 1 -%},{%- endif -%}
    {
      "title": "{{ page.data.title or (page.fileSlug | replace('-', ' ') | titleCase) | replace('"', '\\"') }}",
      "url": "{{ page.url }}",
      "content": {{ content | replace('\n', ' ') | replace('"', '\\"') | dump | safe }},
      "sections": [
        {%- set htmlContent = page.templateContent -%}
        {%- set sections = htmlContent | split('<h2') -%}
        {%- for section in sections -%}
          {%- if section.includes('id="') -%}
            {%- set idStart = section.indexOf('id="') + 4 -%}
            {%- set idEnd = section.indexOf('"', idStart) -%}
            {%- set id = section.substring(idStart, idEnd) -%}
            {%- set contentStart = section.indexOf('>') + 1 -%}
            {%- set titleEnd = section.indexOf('</h2>') -%}
            {%- set sectionTitle = section.substring(contentStart, titleEnd) | striptags -%}
            {%- set sectionContent = section | striptags | truncate(300) -%}
            {%- if loop.index > 1 -%},{%- endif -%}
            {
              "id": "{{ id | replace('"', '\\"') }}",
              "title": "{{ sectionTitle | replace('"', '\\"') | replace('\n', ' ') }}",
              "content": {{ sectionContent | replace('"', '\\"') | replace('\n', ' ') | dump | safe }}
            }
          {%- endif -%}
        {%- endfor -%}
      ]
    }
  {%- endfor -%}
  ]
}
